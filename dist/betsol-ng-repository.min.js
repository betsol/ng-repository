/**
 * betsol-ng-repository - Repository constructor for Angular.js
 * @version v0.0.2
 * @link https://github.com/betsol/ng-repository
 * @license MIT
 *
 * @author Slava Fomin II <s.fomin@betsol.ru>
 */
!function(n,e){"use strict";function t(n){return"/"!=n.substr(-1,1)&&(n+="/"),n}function r(n,e){return n+e}function u(n){var t=[];return e.forEach(n,function(n,e){t.push(("asc"==n?"+":"-")+e)}),t.join(",")}e.module("betsol.repository",["betsol.networking"]).factory("Repository",["$q","request",function(n,o){return function(i,a){function f(n){var t={};return e.forEach(n,function(n,e){"function"!=typeof n&&"$"!=e.charAt(0)&&(t[e]=n)}),t}function s(n){a.modelize&&(c(n),"function"==typeof a.modelize&&a.modelize(n))}function c(t){t.$master=e.copy(t),t.isChanged=function(){return!e.equals(t,t.$master)},t.getChangedData=function(){var n={},t=f(this);return e.forEach(this.$master,function(r,u){var o=t[u];e.equals(r,o)||(n[u]=o)}),n},t.save=function(){if(this.isChanged()){var e=this.getChangedData(t);return t.id&&(e.id=t.id),v.save(e)}return n.resolve()}}function d(n){var e=a.responseTraverser(n);return s(e),n}function h(n){var t=a.responseTraverser(n);return e.forEach(t,function(n){s(n)}),n}var l={modelize:!1,responseTraverser:function(n){return n}};a=e.extend({},l,a),i=t(i);var v={};return v.find=function(n,e,t,r){return n=n||{},e>0&&(n.count=e),t>=0&&(n.offset=t),r&&(n.sort=u(r)),o.get(i,n).then(h)},v.findOneById=function(n,e){return o.get(r(i,n),e).then(d)},v.create=function(n){return o.post(i,null,n).then(d)},v.update=function(n,e){return o.put(r(i,n),null,f(e)).then(d)},v.save=function(n){if(n.id){var e=n.id;return delete n.id,this.update(e,n)}return this.create(n)},v.delete=function(n){return o.delete(r(i,n))},v}}])}(window,angular);